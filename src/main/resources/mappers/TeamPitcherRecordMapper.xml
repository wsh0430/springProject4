<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springProject4.dao.TeamPitcherRecordDao">
    
    <!-- 전체 팀 투수 기록 조회 -->
    <select id="getAllPitcherStats" resultType="com.spring.springProject4.dto.TeamPitcherRecordDto">
        SELECT * FROM team_pitcher_stats
    </select>

    <!-- 특정 팀과 연도의 기록 조회 -->
    <select id="findExistingRecord" resultType="com.spring.springProject4.dto.TeamPitcherRecordDto">
        SELECT *
        FROM team_pitcher_stats
        WHERE team_name = #{teamName}
          AND year = #{year}
    </select>
    
    <select id="getPitcherAverageByYear" resultType="com.spring.springProject4.dto.TeamPitcherRecordDto">
		    SELECT 
		        year,
		        AVG(
		            <choose>
										<when test="field == 'war'">war</when>
										<when test="field == 'gamesP'">games_p</when>
										<when test="field == 'gamesStart'">games_start</when>
										<when test="field == 'completegames'">complete_games</when>
										<when test="field == 'shutouts'">shutouts</when>
										<when test="field == 'wins'">wins</when>
										<when test="field == 'losses'">losses</when>
										<when test="field == 'saves'">saves</when>
										<when test="field == 'holds'">holds</when>
										<when test="field == 'innings'">innings</when>
										<when test="field == 'earnedRuns'">earned_runs</when>
										<when test="field == 'runsAllowed'">runs_allowed</when>
										<when test="field == 'hitsAllowed'">hits_allowed</when>
										<when test="field == 'homeRunsAllowed'">home_runs_allowed</when>
										<when test="field == 'bbAllowed'">bb_allowed</when>
										<when test="field == 'strikeouts'">strikeouts</when>
										<when test="field == 'balks'">balks</when>
										<when test="field == 'wildPitches'">wild_pitches</when>
										<when test="field == 'era'">era</when>
										<when test="field == 'fip'">fip</when>
										<when test="field == 'whip'">whip</when>

		                <otherwise>0</otherwise>
		            </choose>
		        ) AS value
		    FROM team_pitcher_stats
		    WHERE year BETWEEN #{startYear} AND #{endYear}
		    GROUP BY year
		    ORDER BY year
		</select>

    <!-- 기록 삽입 -->
    <insert id="insertPlayerStats">
        INSERT INTO team_pitcher_stats (
            team_name, team_logo, year, war, games_p, games_start, complete_games,
            shutouts, wins, losses, saves, holds, innings, earned_runs,
            runs_allowed, hits_allowed, home_runs_allowed, bb_allowed,
            strikeouts, balks, wild_pitches, era, fip, whip
        ) VALUES (
            #{dto.teamName}, #{dto.teamLogo}, #{dto.year}, #{dto.war},
            #{dto.gamesP}, #{dto.gamesStart}, #{dto.completeGames}, #{dto.shutouts},
            #{dto.wins}, #{dto.losses}, #{dto.saves}, #{dto.holds}, #{dto.innings},
            #{dto.earnedRuns}, #{dto.runsAllowed}, #{dto.hitsAllowed}, #{dto.homeRunsAllowed},
            #{dto.bbAllowed}, #{dto.strikeouts}, #{dto.balks}, #{dto.wildPitches},
            #{dto.era}, #{dto.fip}, #{dto.whip}
        )
    </insert>

    <!-- 기록 업데이트 -->
    <update id="updatePlayerStats">
        UPDATE team_pitcher_stats SET
            team_logo = #{dto.teamLogo},
            war = #{dto.war},
            games_p = #{dto.gamesP},
            games_start = #{dto.gamesStart},
            complete_games = #{dto.completeGames},
            shutouts = #{dto.shutouts},
            wins = #{dto.wins},
            losses = #{dto.losses},
            saves = #{dto.saves},
            holds = #{dto.holds},
            innings = #{dto.innings},
            earned_runs = #{dto.earnedRuns},
            runs_allowed = #{dto.runsAllowed},
            hits_allowed = #{dto.hitsAllowed},
            home_runs_allowed = #{dto.homeRunsAllowed},
            bb_allowed = #{dto.bbAllowed},
            strikeouts = #{dto.strikeouts},
            balks = #{dto.balks},
            wild_pitches = #{dto.wildPitches},
            era = #{dto.era},
            fip = #{dto.fip},
            whip = #{dto.whip}
        WHERE team_name = #{dto.teamName}
          AND year = #{dto.year}
    </update>
</mapper>
